<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Programme IESS -Kairouan</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #4CAF50, #81C784);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    overflow: hidden;
  }

  .container {
    text-align: center;
    background: rgba(0,0,0,0.4);
    padding: 50px 60px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    animation: fadeIn 1.5s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
  }

  .logo {
    width: 220px;
    height: auto;
    margin-bottom: 25px;
    animation: float 4s ease-in-out infinite, rotate3D 8s linear infinite;
    filter: drop-shadow(0 0 15px rgba(255,255,255,0.4));
    transform-style: preserve-3d;
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px) rotateY(0deg); }
    50% { transform: translateY(-12px) rotateY(10deg); }
  }

  @keyframes rotate3D {
    0% { transform: rotateY(0deg); }
    100% { transform: rotateY(360deg); }
  }

  h1 {
    font-size: 30px;
    margin-bottom: 18px;
    text-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }

  p {
    font-size: 17px;
    margin-bottom: 20px;
  }

  input {
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    margin-bottom: 15px;
    text-align: center;
  }

  button {
    background: #ffeb3b;
    color: #333;
    font-size: 18px;
    padding: 12px 28px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  button:hover {
    background: #fbc02d;
    transform: scale(1.08);
  }

  .msg {
    margin-top: 10px;
    font-size: 15px;
  }

  .footer {
    margin-top: 25px;
    font-size: 14px;
    opacity: 0.8;
  }

  .footer img {
    width: 22px;
    height: 15px;
    margin-left: 6px;
    vertical-align: middle;
    animation: wave 2s infinite ease-in-out;
  }

  @keyframes wave {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(10deg); }
  }
</style>
</head>
<body>
  <div class="container">
    <img src="logo_UTSS.png" alt="Logo UTSS" class="logo">
    <h1>IESS - Kairouan</h1>
    <p>Veuillez entrer le mot de passe pour acc√©der √† la carte interactive.</p>
    
    <input type="password" id="password" placeholder="Mot de passe">
    <br>
    <button id="loginBtn">üîê Se connecter</button>
    <div id="message" class="msg"></div>
    
    <div class="footer">
      Powered by Ing. ABBASSI Brahim 
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/ce/Flag_of_Tunisia.svg" alt="Drapeau Tunisien">
    <br>
  <span style="font-size:13px; opacity:0.8;">¬© 2025 ABBASSI ‚Äì Tous droits r√©serv√©s</span>
    </div>
  </div>

<script>
// === S√©curit√© / Authentification simple ===
const PASSWORD = "utss2025"; // üîí mot de passe
const TOKEN_KEY = "site_token";
const SECRET = "cle_privee_ultra_simple";
const MAX_ATTEMPTS = 3;
const LOCK_MINUTES = 2;

// Fonctions utilitaires
function sha256Hex(str){
  const enc = new TextEncoder().encode(str);
  return crypto.subtle.digest("SHA-256", enc).then(b => 
    Array.from(new Uint8Array(b)).map(x => x.toString(16).padStart(2,"0")).join("")
  );
}
function nowMs(){ return Date.now(); }
function getState(){ return JSON.parse(localStorage.getItem("auth_state") || "{}"); }
function saveState(s){ localStorage.setItem("auth_state", JSON.stringify(s)); }
function setMessage(msg, error=false){ 
  const el = document.getElementById("message"); 
  el.textContent = msg; 
  el.style.color = error ? "#ff8080" : "#cfff8f"; 
}

// === Authentification ===
document.getElementById("loginBtn").addEventListener("click", async () => {
  const pwd = document.getElementById("password").value.trim();
  const st = getState();
  const now = nowMs();

  if(st.lockedUntil && now < st.lockedUntil){
    const diff = Math.ceil((st.lockedUntil - now)/60000);
    setMessage(`Compte verrouill√©. R√©essayez dans ${diff} min.`, true);
    return;
  }

  if(pwd === PASSWORD){
    // reset tentatives
    localStorage.removeItem("auth_state");
    const exp = now + 20*60*1000; // 20 min
    const sig = await sha256Hex(SECRET + "|" + exp);
    const token = {user:"admin", exp:exp, sig:sig};
    localStorage.setItem(TOKEN_KEY, btoa(JSON.stringify(token)));
    window.location.href = "CarteSousse.html";
  } else {
    st.attempts = (st.attempts || 0) + 1;
    if(st.attempts >= MAX_ATTEMPTS){
      st.lockedUntil = now + LOCK_MINUTES*60*1000;
      setMessage(`Trop d'essais. Verrouillage ${LOCK_MINUTES} minutes.`, true);
    } else {
      const rest = MAX_ATTEMPTS - st.attempts;
      setMessage(`Mot de passe incorrect. ${rest} tentative(s) restante(s).`, true);
    }
    saveState(st);
  }
});
</script>
</body>
</html>



